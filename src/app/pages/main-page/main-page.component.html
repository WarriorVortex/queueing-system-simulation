<div class="simulation-panel">
  @if (usedBlocks.use_params.signal()) {
    <div class="parameters-section">
      <h3>Параметры моделирования</h3>
      <div class="parameters-section__grid">
        <div class="parameter">
          <label>Приборы:</label>
          <input type="number" min="0" step="1" [(ngModel)]="devicesNumber"/>
        </div>
        <div class="parameter">
          <label>Источники:</label>
          <input type="number" min="0" step="1" [(ngModel)]="sourcesNumber"/>
        </div>
        <div class="parameter">
          <label>Буфер:</label>
          <input type="number" min="0" step="1" [(ngModel)]="bufferCapacity"/>
        </div>
        <div class="parameter">
          <label>Мин. интервал:</label>
          <input type="number" min="0" [(ngModel)]="intervalParams.a"/>
        </div>
        <div class="parameter">
          <label>Макс. интервал:</label>
          <input type="number" min="0" [(ngModel)]="intervalParams.b"/>
        </div>
        <div class="parameter">
          <label>Интенсивность:</label>
          <input type="number" min="0" [(ngModel)]="serviceTimeParams.lambda"/>
        </div>
        <div class="parameter">
          <label>Время моделир.:</label>
          <input type="number" min="0" [(ngModel)]="simulationEndTime"/>
        </div>
        <div class="parameter">
          <label>Скорость: {{ simulationInterval() }} мс</label>
          <input type="range" min="0" max="3000" step="50" [(ngModel)]="simulationInterval"/>
        </div>
      </div>
    </div>
  }

  @if (usedBlocks.use_control.signal()) {
    <div class="control-section">
      <div class="control-section__buttons">
        <button (click)="startSimulation()" class="primary">
          {{ isStarted() ? 'Перезапустить' : 'Старт' }}
        </button>
        <button (click)="simulateNextStep()">
          Следующий шаг
        </button>
        <button (click)="simulateAllSteps()">
          Полное моделирование
        </button>
        @let n = simulationStep();
        <button (click)="simulateNSteps(n)">
          Авто ({{ n }})
        </button>
      </div>
      <div class="control-section__info">
        <div class="control-section__info-row">
        <span>
          Шаг: <strong>{{ currentStep() }}</strong>
        </span>
          <span>
          Время: <strong>{{ currentTime() }}</strong>
        </span>
        </div>
      </div>
    </div>
  }
</div>

@if (usedBlocks.use_buffer.signal()) {
  <div class="buffer-section">
    <h3>Ячейки буфера</h3>
    <app-buffer-block [bufferCells]="bufferCells"></app-buffer-block>
  </div>
}

@if (usedBlocks.use_devices.signal()) {
  <div class="devices-section">
    <h3>Приборы</h3>
    <app-devices-block [devices]="devices"></app-devices-block>
  </div>
}

@if (usedBlocks.use_diagram.signal()) {
  <div class="diagram-section">
    <h3>Временная диаграмма</h3>
    <app-timeline-diagram [resolution]="10"></app-timeline-diagram>
  </div>
}

@let useCalendar = usedBlocks.use_event_calendar.signal();
@let useSourceStats = usedBlocks.use_source_stats.signal();
@if (useCalendar || useSourceStats) {
  <div class="stats-section">
    @if (useCalendar) {
      <div class="stats-section__calendar">
        <h3>Календарь событий</h3>
        <app-events-calendar [sources]="sources" [devices]="devices"></app-events-calendar>
      </div>
    }
    @if (useSourceStats) {
      <div class="stats-section__sources">
        <h3>Статистика по источникам</h3>
        <app-sources-stats-block></app-sources-stats-block>
      </div>
    }
  </div>
}

@if (usedBlocks.use_summary_stats.signal()) {
  <div class="summary-section">
    <h3>Общая статистика системы</h3>
    <app-summary-stats-block></app-summary-stats-block>
  </div>
}

@if (usedBlocks.use_logs.signal()) {
  <div class="logs-section">
    <h3>Сообщения</h3>
    <app-log-block [style.height.px]="24 * logsShowNumber" [logs]="messages"></app-log-block>
  </div>
}
